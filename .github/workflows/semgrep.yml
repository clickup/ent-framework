# Name of this GitHub Actions workflow.
name: Semgrep

on:
    # Scan changed files in PRs (diff-aware scanning):
    pull_request:
        branches: ['main']

    # Schedule the CI job (this method uses cron syntax):
    schedule:
        - cron: '0 0 * * MON-FRI'

jobs:
    semgrep:
        # User definable name of this GitHub Actions job.
        name: Scan
        # If you are self-hosting, change the following `runs-on` value:
        runs-on: ubuntu-latest

        container:
            # A Docker image with Semgrep installed. Do not change this.
            image: semgrep/semgrep@sha256:7b625711ba9b6d1a543e308967b18c01b59932490a5536a06422666474bf6ee4

        # Skip any PR created by dependabot to avoid permission issues:
        if: (github.actor != 'dependabot[bot]')

        steps:
            # Fetch project source with GitHub Actions Checkout.
            - uses: actions/checkout@d632683dd7b4114ad314bca15554477dd762a938 # v4.2.0
            # Run the "semgrep ci" command on the command line of the docker image.
            - run: semgrep ci
              env:
                  # Connect to Semgrep Cloud Platform through your SEMGREP_APP_TOKEN.
                  # Generate a token from Semgrep Cloud Platform > Settings
                  # and add it to your GitHub secrets.
                  SEMGREP_APP_TOKEN: ${{ secrets.SEMGREP_APP_TOKEN }}
